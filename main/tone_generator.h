#pragma once

#include "esp_err.h"

#include "freertos/FreeRTOS.h"

#define FREQUENCY_C_0 (16.351598739624023f)
#define FREQUENCY_C_SHARP_0 (17.32391357421875f)
#define FREQUENCY_D_0 (18.354047775268555f)
#define FREQUENCY_D_SHARP_0 (19.445436477661133f)
#define FREQUENCY_E_0 (20.601722717285156f)
#define FREQUENCY_F_0 (21.826765060424805f)
#define FREQUENCY_F_SHARP_0 (23.124650955200195f)
#define FREQUENCY_G_0 (24.499713897705078f)
#define FREQUENCY_G_SHARP_0 (25.95654296875f)
#define FREQUENCY_A_0 (27.5f)
#define FREQUENCY_A_SHARP_0 (29.135234832763672f)
#define FREQUENCY_B_0 (30.867706298828125f)
#define FREQUENCY_C_1 (32.70319747924805f)
#define FREQUENCY_C_SHARP_1 (34.6478271484375f)
#define FREQUENCY_D_1 (36.70809555053711f)
#define FREQUENCY_D_SHARP_1 (38.890872955322266f)
#define FREQUENCY_E_1 (41.20344543457031f)
#define FREQUENCY_F_1 (43.65353012084961f)
#define FREQUENCY_F_SHARP_1 (46.24930191040039f)
#define FREQUENCY_G_1 (48.999427795410156f)
#define FREQUENCY_G_SHARP_1 (51.9130859375f)
#define FREQUENCY_A_1 (55.0f)
#define FREQUENCY_A_SHARP_1 (58.270469665527344f)
#define FREQUENCY_B_1 (61.73541259765625f)
#define FREQUENCY_C_2 (65.4063949584961f)
#define FREQUENCY_C_SHARP_2 (69.295654296875f)
#define FREQUENCY_D_2 (73.41619110107422f)
#define FREQUENCY_D_SHARP_2 (77.78174591064453f)
#define FREQUENCY_E_2 (82.40689086914062f)
#define FREQUENCY_F_2 (87.30706024169922f)
#define FREQUENCY_F_SHARP_2 (92.49860382080078f)
#define FREQUENCY_G_2 (97.99885559082031f)
#define FREQUENCY_G_SHARP_2 (103.826171875f)
#define FREQUENCY_A_2 (110.0f)
#define FREQUENCY_A_SHARP_2 (116.54093933105469f)
#define FREQUENCY_B_2 (123.4708251953125f)
#define FREQUENCY_C_3 (130.8127899169922f)
#define FREQUENCY_C_SHARP_3 (138.59130859375f)
#define FREQUENCY_D_3 (146.83238220214844f)
#define FREQUENCY_D_SHARP_3 (155.56349182128906f)
#define FREQUENCY_E_3 (164.81378173828125f)
#define FREQUENCY_F_3 (174.61412048339844f)
#define FREQUENCY_F_SHARP_3 (184.99720764160156f)
#define FREQUENCY_G_3 (195.99771118164062f)
#define FREQUENCY_G_SHARP_3 (207.65234375f)
#define FREQUENCY_A_3 (220.0f)
#define FREQUENCY_A_SHARP_3 (233.08187866210938f)
#define FREQUENCY_B_3 (246.941650390625f)
#define FREQUENCY_C_4 (261.6255798339844f)
#define FREQUENCY_C_SHARP_4 (277.1826171875f)
#define FREQUENCY_D_4 (293.6647644042969f)
#define FREQUENCY_D_SHARP_4 (311.1269836425781f)
#define FREQUENCY_E_4 (329.6275634765625f)
#define FREQUENCY_F_4 (349.2282409667969f)
#define FREQUENCY_F_SHARP_4 (369.9944152832031f)
#define FREQUENCY_G_4 (391.99542236328125f)
#define FREQUENCY_G_SHARP_4 (415.3046875f)
#define FREQUENCY_A_4 (440.0f)
#define FREQUENCY_A_SHARP_4 (466.16375732421875f)
#define FREQUENCY_B_4 (493.88330078125f)
#define FREQUENCY_C_5 (523.2511596679688f)
#define FREQUENCY_C_SHARP_5 (554.365234375f)
#define FREQUENCY_D_5 (587.3295288085938f)
#define FREQUENCY_D_SHARP_5 (622.2539672851562f)
#define FREQUENCY_E_5 (659.255126953125f)
#define FREQUENCY_F_5 (698.4564819335938f)
#define FREQUENCY_F_SHARP_5 (739.9888305664062f)
#define FREQUENCY_G_5 (783.9908447265625f)
#define FREQUENCY_G_SHARP_5 (830.609375f)
#define FREQUENCY_A_5 (880.0f)
#define FREQUENCY_A_SHARP_5 (932.3275146484375f)
#define FREQUENCY_B_5 (987.7666015625f)
#define FREQUENCY_C_6 (1046.5023193359375f)
#define FREQUENCY_C_SHARP_6 (1108.73046875f)
#define FREQUENCY_D_6 (1174.6590576171875f)
#define FREQUENCY_D_SHARP_6 (1244.5079345703125f)
#define FREQUENCY_E_6 (1318.51025390625f)
#define FREQUENCY_F_6 (1396.9129638671875f)
#define FREQUENCY_F_SHARP_6 (1479.9776611328125f)
#define FREQUENCY_G_6 (1567.981689453125f)
#define FREQUENCY_G_SHARP_6 (1661.21875f)
#define FREQUENCY_A_6 (1760.0f)
#define FREQUENCY_A_SHARP_6 (1864.655029296875f)
#define FREQUENCY_B_6 (1975.533203125f)
#define FREQUENCY_C_7 (2093.004638671875f)
#define FREQUENCY_C_SHARP_7 (2217.4609375f)
#define FREQUENCY_D_7 (2349.318115234375f)
#define FREQUENCY_D_SHARP_7 (2489.015869140625f)
#define FREQUENCY_E_7 (2637.0205078125f)
#define FREQUENCY_F_7 (2793.825927734375f)
#define FREQUENCY_F_SHARP_7 (2959.955322265625f)
#define FREQUENCY_G_7 (3135.96337890625f)
#define FREQUENCY_G_SHARP_7 (3322.4375f)
#define FREQUENCY_A_7 (3520.0f)
#define FREQUENCY_A_SHARP_7 (3729.31005859375f)
#define FREQUENCY_B_7 (3951.06640625f)
#define FREQUENCY_C_8 (4186.00927734375f)
#define FREQUENCY_C_SHARP_8 (4434.921875f)
#define FREQUENCY_D_8 (4698.63623046875f)
#define FREQUENCY_D_SHARP_8 (4978.03173828125f)
#define FREQUENCY_E_8 (5274.041015625f)
#define FREQUENCY_F_8 (5587.65185546875f)
#define FREQUENCY_F_SHARP_8 (5919.91064453125f)
#define FREQUENCY_G_8 (6271.9267578125f)
#define FREQUENCY_G_SHARP_8 (6644.875f)
#define FREQUENCY_A_8 (7040.0f)
#define FREQUENCY_A_SHARP_8 (7458.6201171875f)
#define FREQUENCY_B_8 (7902.1328125f)

#ifdef __cplusplus
extern "C" {
#endif

typedef struct {
  bool entuned;
  float frequency;
  int64_t attack_time;    // in microseconds
  int64_t decay_time;     // in microseconds
  uint16_t sustain_level; // 0-0xffff
  // In microseconds. Note that once a generator is released, it will no longer
  // repsect entune/detune calls, so release time should be fairly short
  int64_t release_time;
} tone_generator_config_t;

typedef struct tone_generator *tone_generator_t;

esp_err_t tone_generator_init(tone_generator_config_t *config,
                              tone_generator_t *generator);
void tone_generator_release(tone_generator_t generator);
void tone_generator_entune(tone_generator_t generator);
void tone_generator_detune(tone_generator_t generator);
void tone_generator_set_entuned(tone_generator_t generator, bool entuned);

#ifdef __cplusplus
}
#endif
